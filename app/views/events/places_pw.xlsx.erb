<%=
  p = Axlsx::Package.new
  wb = p.workbook

  wb.styles do |s|
    $green = s.add_style :bg_color => "22FF99", :border => { :style => :thin, :color => "00" }, :alignment => { :horizontal => :left, :wrap_text => true}
    $red = s.add_style :bg_color => "DD3311", :border => { :style => :thin, :color => "00" }, :alignment => { :horizontal => :left, :wrap_text => true }
    $yellow = s.add_style :bg_color => "EEEE55", :border => { :style => :thin, :color => "00" }, :alignment => { :horizontal => :left, :wrap_text => true }
    $orange = s.add_style :bg_color => "EEAA55", :border => { :style => :thin, :color => "00" }, :alignment => { :horizontal => :left, :wrap_text => true }
    $white = s.add_style :border => { :style => :thin, :color => "00" }, :alignment => { :horizontal => :left, :wrap_text => true }
    $black = s.add_style :bg_color => "00", :fg_color => "FF", :sz => 14, :alignment => { :horizontal=> :center }, :border => { :style => :thin, :color => "CC" }
    $blue =  s.add_style  :bg_color => "0000FF", :fg_color => "FF", :sz => 20, :alignment => { :horizontal=> :center }
    $bold = s.add_style :b => true
    $very_bold = s.add_style :sz => 14, :b => true
    $align_left = s.add_style :alignment => { :horizontal => :left }
    $wrap_text = s.add_style :alignment => { :horizontal => :left, :wrap_text => true}

    def format_property(property, event = nil)
      property = property.to_s
      if property.blank?
        style = $orange
      elsif event.fresh?
        style = $white
      else
        style = $green
      end

      [property, style]
    end


    wb.add_worksheet(:name => Settings.schedule.title.truncate(27)) do |sheet|
      sheet.add_row ["Τίτλος Δράσης", "Σημείο Διεξαγωγής", "Σημείο στο Χάρτη"], :style => $black

      @events.each do |event|
        if not event.hidden?
          style = $white

          row = []
          row.push [event.title, $bold]
          row.push [event.space, style]

          sheet.add_row row.map(&:first), style: row.map(&:second), :height => 20
        end
      end

      # Title
      sheet.column_info[0].width = 80

      # Space
      sheet.column_info[1].width = 50
    end
  end

  raw p.to_stream.string
  %>
