\documentclass[14pt,oneside,a4paper]{memoir}

\pageaiv % A4 page
\pagestyle{empty} % No header/footer

\usepackage{fontspec}
\setmainfont{Times New Roman}
\setsansfont{Arial}
\usepackage{polyglossia}
\newfontfamily\greekfont[Script=Greek]{Times New Roman}
\newfontfamily\greekfontsf[Script=Greek]{Arial}
\newfontfamily\greekfonttt[Script=Greek]{Latin Modern Mono}
\setdefaultlanguage{greek}
\setotherlanguage{english}

%\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}

\usepackage{hyperref}
\usepackage{color}

\setlength{\parindent}{0pt}
\setlength{\parskip}{15pt}
\setlength{\headheight}{0pt}
\setlength{\headsep}{0pt}
\setlength{\topmargin}{0cm}
\setlength{\textheight}{24cm}
\setafterparaskip{0.1ex}

\newenvironment{stayonpage}
{\par\nobreak\vfil\penalty0\vfilneg
\vtop\bgroup}
{\par\xdef\tpd{\the\prevdepth}\egroup
\prevdepth=\tpd}

\newcommand\disappearingrule{%
\par % make sure we end a paragraph
\vskip20pt % space above the rule
\leaders\vrule width \textwidth\vskip0.4pt % rule thickness is 0.4pt
\nointerlineskip % disable interline glue here
\vskip20pt % space below the rule
}

\begin{document}
<% if Settings.schedule.draft %>
    \begin{center}
      \textbf{Πρόχειρο}

      \textbf{Έκδοση <%= Audited::Audit.last.id %>}
    \end{center}
<% end %>

% hello

<% c_id = 0 %>

<% @events.each_with_index do |event, idx| %>
    <% if event.hidden %>
        <% next %>
    <% elsif (Settings.schedule.hide_unscheduled or event.kind == 'concert') and event.repetitions.empty? %>
        <% next %>
    <% end %>

  <% if event.kind == 'concert' %>
      <% if @concerts and @concerts.include? event %>
          <% next %>
      <% end %>

      <% @concerts = consecutive_concerts(event) %>
      <%= render 'concerts', c_id: c_id %>
      <% c_id += 1 %>
      <% next %>
  <% end %>

  \begin{stayonpage}
    <% if Settings.schedule.mark_fresh and event.fresh? %>
      \color{red}
    <% end %>

    <% if idx != 0 %>
      %\paragraph{} \hspace{0pt}
    <% end %>

    <% unless event.team.strip.empty? %>
      <%= event.team.texcape %>
      \\
    <% end %>
    \textbf{<%= event.title.texcape %>}

    <%= (event.abstract || event.other).to_s.texcape %>

    <% if event.repetitions.any? %>
      \textbf{<%= many_repetitions?(event.repetitions) ? "Ημερομηνίες" : "Ημερομηνία" %>:}
      <%= format_many_repetitions event.repetitions, time: !repetitions_same_time?(event) %>
    <% end %>
    <% if repetitions_same_time?(event) && (time = common_time(event)) %>
      \\ \textbf{<%= (event.time_description || "Ώρα").texcape %>:} <%= time.mb_chars.capitalize.to_s %>
    <% end %>
    <% unless event.space.empty? %>
      <% if defined?(time) and time %>\\<% end %>
      \textbf{<%= (event.place_description || "Χώρος διεξαγωγής").texcape %>:} <%= event.space.texcape %>
    <% end %>
    <% event.properties.each do |property| %>
        \\
        \textbf{<%= property.name %>:} <%= property.value %>
    <% end %>
  \end{stayonpage}

    \disappearingrule
<% end %>
<% if Settings.schedule.show_unscheduled_concerts %>
    <% @concerts = Event.left_outer_joins(:repetitions).where(repetitions:{id:nil},kind:"concert") %>
    <%= render 'concerts', c_id: c_id %>
<% end %>
\end{document}